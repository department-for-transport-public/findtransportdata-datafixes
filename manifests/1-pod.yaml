apiVersion: v1
kind: ServiceAccount
metadata:
  name: postman-runner-serviceaccount
  namespace: dft-nap-dev
  annotations:
    iam.gke.io/gcp-service-account: gke-workload@PROJECT_ID.iam.gserviceaccount.com
---
apiVersion: v1
kind: Pod
metadata:
  name: postman-runner-BRANCH_NAME
  namespace: dft-nap-dev
spec:
  serviceAccountName: postman-runner-serviceaccount
  containers:
  - name: postman-runner
    image: postman/newman
    command: ["newman"]
    args: ["run","https://api.postman.com/collections/21262774-28a17fc1-d03a-4e57-b2a5-f12b29e39352?access_key=PMAT-01GJFGF153XH2VAPAY0A03JYE1","-e","/srv/config/env.json","--insecure"]
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    volumeMounts:
    - name: postman-config-secret
      mountPath: "/srv/config"
      readOnly: true
  restartPolicy: Never
  volumes:
    - name: postman-config-secret
      csi:
        driver: secrets-store.csi.k8s.io
        readOnly: true
        volumeAttributes:
          secretProviderClass: "gcp-secret-provider"

  